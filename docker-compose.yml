version: "3"

services:
  base:
    build:
      context: docker-common
      dockerfile: Dockerfile.jre8
    image: centos-base:jre8
    entrypoint: /bin/bash

  builder:
    build:
      context: docker-common
      dockerfile: Dockerfile.scala-sbt
    image: builder:scala-sbt
    entrypoint: /bin/bash

  dev:
    build:
      context: .
      dockerfile: docker/Dockerfile.dev
    image: builder:dev
    entrypoint: /bin/bash
    depends_on:
      - builder

  test:
    build:
      context: .
      dockerfile: docker/Dockerfile.test
    image: builder:test
    entrypoint: /bin/bash -c "sbt test"
    depends_on:
      - dev

  kafka-proxy:
    build:
      context: .
      dockerfile: docker/Dockerfile
      args:
        - SCALA_VERSION=2.12
        - KAFKA_PROXY_VERSION=0.1.0-rc1
    image: kafka-proxy:0.1.0-rc1
    # Disable running this docker container in docker-compose.yml
    entrypoint: /bin/bash
    depends_on:
      - base
      - builder
